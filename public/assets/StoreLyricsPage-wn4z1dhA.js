import{e as O,g as U,s as V,P as N,k as W,l as X,m as J,_ as I,j as e,n as K,o as Q,p as Y,R as d,T as M,I as Z,K as G,b,r as j,i as p,B as g,S as x,J as v,M as ee,N as te,Q as se,D as L,U as re,H as ae,c as ne,A as oe,V as ie,d as A}from"./index-kUZq1El7.js";function le(t){return O("MuiCard",t)}U("MuiCard",["root"]);const ce=["className","raised"],de=t=>{const{classes:s}=t;return Q({root:["root"]},le,s)},ue=V(N,{name:"MuiCard",slot:"Root",overridesResolver:(t,s)=>s.root})(()=>({overflow:"hidden"})),he=W.forwardRef(function(s,r){const n=X({props:s,name:"MuiCard"}),{className:i,raised:a=!1}=n,u=J(n,ce),l=I({},n,{raised:a}),h=de(l);return e.jsx(ue,I({className:K(h.root,i),elevation:a?8:void 0,ref:r,ownerState:l},u))}),xe=he,fe=Y(e.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),ve=({onAdded:t,defaultVal:s})=>{const[r,n]=d.useState(s),i=()=>{t&&t(r)};return e.jsxs(d.Fragment,{children:[e.jsx(M,{variant:"h6",children:"Add lyrics"}),e.jsx(xe,{sx:{display:"flex",width:"75%",height:"100%",justifyContent:"start",alignItems:"start",p:3,borderTopRightRadius:25,borderBottomLeftRadius:25,overflow:"auto",border:a=>`1px solid ${a.palette.primary.light}`},elevation:0,children:e.jsx(Z,{value:r,onChange:a=>n(a.currentTarget.value),placeholder:"Write the lyrics here...",sx:{width:"100%",minHeight:"100%",textAlign:"start",justifyContent:"start",alignItems:"start",direction:G(r)},multiline:!0})}),e.jsx(b,{variant:"contained",onClick:i,children:"Add"})]})};var C={},je=p;Object.defineProperty(C,"__esModule",{value:!0});var B=C.default=void 0,pe=je(j()),P=e;B=C.default=(0,pe.default)([(0,P.jsx)("path",{d:"m15.45 16.52-3.01-3.01c-.11-.11-.24-.13-.31-.13s-.2.02-.31.13L8.8 16.53c-.34.34-.87.89-2.64.89l3.71 3.7c1.17 1.17 3.07 1.17 4.24 0l3.72-3.71c-.91 0-1.67-.18-2.38-.89M8.8 7.47l3.02 3.02c.08.08.2.13.31.13s.23-.05.31-.13l2.99-2.99c.71-.74 1.52-.91 2.43-.91l-3.72-3.71c-1.17-1.17-3.07-1.17-4.24 0l-3.71 3.7c1.76 0 2.3.58 2.61.89"},"0"),(0,P.jsx)("path",{d:"m21.11 9.85-2.25-2.26H17.6c-.54 0-1.08.22-1.45.61l-3 3c-.28.28-.65.42-1.02.42-.36 0-.74-.15-1.02-.42L8.09 8.17c-.38-.38-.9-.6-1.45-.6H5.17l-2.29 2.3c-1.17 1.17-1.17 3.07 0 4.24l2.29 2.3h1.48c.54 0 1.06-.22 1.45-.6l3.02-3.02c.28-.28.65-.42 1.02-.42s.74.14 1.02.42l3.01 3.01c.38.38.9.6 1.45.6h1.26l2.25-2.26c1.17-1.18 1.17-3.1-.02-4.29"},"1")],"Pix");const me=({offset:t,time:s,selected:r,onClick:n})=>e.jsx(g,{sx:{width:10,height:10,position:"absolute",inset:`0 0 0 ${t}%`},children:e.jsx(g,{onClick:n,title:s,sx:{transform:"translateX(-50%)",cursor:"pointer",":hover":{transform:"translateX(-50%) scale(1.1)"}},children:e.jsx(B,{color:r?"primary":"inherit",sx:{width:"100%",height:"100%"}})})});var _={},ge=p;Object.defineProperty(_,"__esModule",{value:!0});var D=_.default=void 0,ye=ge(j()),we=e;D=_.default=(0,ye.default)((0,we.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");var R={},Ce=p;Object.defineProperty(R,"__esModule",{value:!0});var T=R.default=void 0,_e=Ce(j()),Re=e;T=R.default=(0,_e.default)((0,Re.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");var k={},ke=p;Object.defineProperty(k,"__esModule",{value:!0});var z=k.default=void 0,$e=ke(j()),Se=e;z=k.default=(0,$e.default)((0,Se.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var $={},Ie=p;Object.defineProperty($,"__esModule",{value:!0});var E=$.default=void 0,Le=Ie(j()),Pe=e;E=$.default=(0,Le.default)((0,Pe.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove");const Me=({audio:t,onAdd:s,onRemove:r,onBackward:n,onForward:i})=>e.jsxs(x,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsxs(x,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsx(v,{size:"small",onClick:s,children:e.jsx(z,{})}),e.jsx(v,{size:"small",onClick:r,children:e.jsx(E,{})})]}),e.jsxs(x,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsx(v,{size:"small",onClick:n,children:e.jsx(T,{})}),e.jsx(ee,{audio:t}),e.jsx(v,{size:"small",onClick:i,children:e.jsx(D,{})})]})]}),be=({max:t=100,audio:s,onCurrentTimeChange:r,currentTime:n,setCurrentTime:i,stamps:a,setStamps:u})=>{const[l,h]=d.useState(100),y=o=>{h(c=>{var m=c-o.deltaY/2;return m>2e3&&(m=2e3),m<100?100:m})},f=()=>{const o=w(a,n)-1;S(o)},H=()=>{const o=w(a,n)+1;S(o)},S=o=>{var c=o;c>=a.length&&(c=a.length-1),s.current.currentTime=a[c<0?0:c]||0},q=()=>{const o=w(a,n);o>0&&n==a[o-1]||(a.splice(o,0,n),u([...a]))},F=()=>{const o=a.findIndex(c=>c==n);o!=-1&&(a.splice(o,1),u([...a]))};return e.jsxs(x,{sx:{width:"100%"},children:[e.jsx(g,{sx:{width:"100%",overflow:"hidden",px:2},onWheel:y,children:e.jsxs(g,{sx:{width:`${l}%`,height:50,position:"relative",display:"flex",alignItems:"end"},children:[a.map((o,c)=>e.jsx(me,{offset:o/t*100,time:o,selected:n==o,onClick:()=>i&&i(o)},c)),e.jsx(te,{noLabels:!0,audio:s,onCurrentTimeChange:o=>r(o&&parseFloat(o.toFixed(1)))})]})}),e.jsx(Me,{audio:s,onAdd:q,onRemove:F,onBackward:f,onForward:H})]})},w=(t,s)=>{for(var r=0;r<t.length;++r)if(s<t[r])return r;return t.length},Ae=({audio:t,onTimeChange:s,stamps:r,setStamps:n,lyrics:i,onEdit:a,onSave:u})=>{const[l,h]=d.useState(null);return e.jsxs(x,{sx:{width:"100%",height:"90%"},children:[e.jsx(se,{flex:1,seekTime:s,current:l,stamps:r,lyrics:i}),e.jsx(L,{sx:{mb:1}}),e.jsxs(x,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(M,{children:re(l)}),e.jsx(v,{onClick:a,children:e.jsx(fe,{})}),e.jsx(b,{variant:"contained",onClick:u,children:"Save"})]}),e.jsx(L,{sx:{my:1}}),e.jsx(be,{stamps:r,setStamps:n,audio:t,setCurrentTime:s,currentTime:l,onCurrentTimeChange:h,max:t==null?void 0:t.current.duration})]})},ze=()=>{const t=ae("track_root"),s=d.useRef(new Audio),[r,n]=d.useState(null),[i,a]=d.useState([]),[u,l]=d.useState(!1),{setInfo:h}=ne();d.useEffect(()=>{Be(t.data,n,a)},[t.data]),d.useEffect(()=>(s.current&&t&&(s.current.src=`${oe}api/tracks/${t.data.id}/stream`),()=>{s.current&&(s.current.src="")}),[s.current,t]);const y=f=>{s.current.currentTime=f};return r===null?e.jsx(ie,{}):r===""||u?e.jsx(x,{sx:{width:"100%",height:"85%",alignItems:"center"},spacing:2,children:e.jsx(ve,{defaultVal:r,onAdded:f=>{n(f),l(!1)}})}):e.jsx(Ae,{audio:s,lyrics:r,stamps:i,setStamps:a,onTimeChange:y,onEdit:()=>l(!0),onSave:()=>De(t.data,r,i,h)})},Be=async(t,s,r)=>{try{const i=await(await A(`api/lyrics/tracks/${t.id}`)).json();s(i.data.lyrics);const a=i.data.timestamps.split(",");return r(i.data.timestamps.length==0?[]:a)}catch{s(""),r([])}},De=async(t,s="",r=[],n)=>{var i={lyrics:s};r&&r.length>0&&(i.timestamps=r.join(",")),(await A(`api/lyrics/tracks/${t.id}`,"POST",i)).ok&&n("Lyrics had been updated successfully")};export{ze as default};
