import{e as U,g as E,s as N,P as V,k as W,l as X,m as J,_ as I,j as e,n as K,o as Q,R as c,T as b,I as Y,K as Z,b as A,r as j,i as p,B as v,S as h,J as y,M as G,N as ee,H as te,c as re,A as se,Q as ae,U as ne,D as P,V as oe,d as M}from"./index-59b23e8a.js";function ie(r){return U("MuiCard",r)}E("MuiCard",["root"]);const le=["className","raised"],ce=r=>{const{classes:t}=r;return Q({root:["root"]},ie,t)},de=N(V,{name:"MuiCard",slot:"Root",overridesResolver:(r,t)=>t.root})(()=>({overflow:"hidden"})),ue=W.forwardRef(function(t,s){const a=X({props:t,name:"MuiCard"}),{className:o,raised:i=!1}=a,d=J(a,le),u=I({},a,{raised:i}),x=ce(u);return e.jsx(de,I({className:K(x.root,o),elevation:i?8:void 0,ref:s,ownerState:u},d))}),he=ue,xe=({onAdded:r})=>{const[t,s]=c.useState(""),a=()=>{r&&r(t)};return e.jsxs(c.Fragment,{children:[e.jsx(b,{variant:"h6",children:"Add lyrics"}),e.jsx(he,{sx:{display:"flex",width:"75%",height:"100%",justifyContent:"start",alignItems:"start",p:3,borderTopRightRadius:25,borderBottomLeftRadius:25,overflow:"auto",border:o=>`1px solid ${o.palette.primary.light}`},elevation:0,children:e.jsx(Y,{value:t,onChange:o=>s(o.currentTarget.value),placeholder:"Write the lyrics here...",sx:{width:"100%",minHeight:"100%",textAlign:"start",justifyContent:"start",alignItems:"start",direction:Z(t)},multiline:!0})}),e.jsx(A,{variant:"contained",onClick:a,children:"Add"})]})};var w={},fe=p;Object.defineProperty(w,"__esModule",{value:!0});var D=w.default=void 0,ve=fe(j()),L=e,je=(0,ve.default)([(0,L.jsx)("path",{d:"m15.45 16.52-3.01-3.01c-.11-.11-.24-.13-.31-.13s-.2.02-.31.13L8.8 16.53c-.34.34-.87.89-2.64.89l3.71 3.7c1.17 1.17 3.07 1.17 4.24 0l3.72-3.71c-.91 0-1.67-.18-2.38-.89zM8.8 7.47l3.02 3.02c.08.08.2.13.31.13s.23-.05.31-.13l2.99-2.99c.71-.74 1.52-.91 2.43-.91l-3.72-3.71c-1.17-1.17-3.07-1.17-4.24 0l-3.71 3.7c1.76 0 2.3.58 2.61.89z"},"0"),(0,L.jsx)("path",{d:"m21.11 9.85-2.25-2.26H17.6c-.54 0-1.08.22-1.45.61l-3 3c-.28.28-.65.42-1.02.42-.36 0-.74-.15-1.02-.42L8.09 8.17c-.38-.38-.9-.6-1.45-.6H5.17l-2.29 2.3c-1.17 1.17-1.17 3.07 0 4.24l2.29 2.3h1.48c.54 0 1.06-.22 1.45-.6l3.02-3.02c.28-.28.65-.42 1.02-.42s.74.14 1.02.42l3.01 3.01c.38.38.9.6 1.45.6h1.26l2.25-2.26c1.17-1.18 1.17-3.1-.02-4.29z"},"1")],"Pix");D=w.default=je;const pe=({offset:r,time:t,selected:s,onClick:a})=>e.jsx(v,{sx:{width:10,height:10,position:"absolute",inset:`0 0 0 ${r}%`},children:e.jsx(v,{onClick:a,title:t,sx:{transform:"translateX(-50%)",cursor:"pointer",":hover":{transform:"translateX(-50%) scale(1.1)"}},children:e.jsx(D,{color:s?"primary":"inherit",sx:{width:"100%",height:"100%"}})})});var C={},me=p;Object.defineProperty(C,"__esModule",{value:!0});var z=C.default=void 0,ge=me(j()),ye=e,_e=(0,ge.default)((0,ye.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");z=C.default=_e;var $={},we=p;Object.defineProperty($,"__esModule",{value:!0});var B=$.default=void 0,Ce=we(j()),$e=e,Re=(0,Ce.default)((0,$e.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");B=$.default=Re;var R={},ke=p;Object.defineProperty(R,"__esModule",{value:!0});var T=R.default=void 0,Se=ke(j()),Ie=e,Pe=(0,Se.default)((0,Ie.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");T=R.default=Pe;var k={},Le=p;Object.defineProperty(k,"__esModule",{value:!0});var H=k.default=void 0,be=Le(j()),Ae=e,Me=(0,be.default)((0,Ae.jsx)("path",{d:"M19 13H5v-2h14v2z"}),"Remove");H=k.default=Me;const De=({audio:r,onAdd:t,onRemove:s,onBackward:a,onForward:o})=>e.jsxs(h,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsxs(h,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsx(y,{size:"small",onClick:t,children:e.jsx(T,{})}),e.jsx(y,{size:"small",onClick:s,children:e.jsx(H,{})})]}),e.jsxs(h,{width:"100%",direction:"row",justifyContent:"space-evenly",children:[e.jsx(y,{size:"small",onClick:a,children:e.jsx(B,{})}),e.jsx(G,{audio:r}),e.jsx(y,{size:"small",onClick:o,children:e.jsx(z,{})})]})]}),ze=({max:r=100,audio:t,onCurrentTimeChange:s,currentTime:a,setCurrentTime:o,stamps:i,setStamps:d})=>{const[u,x]=c.useState(100),m=n=>{x(l=>{var g=l-n.deltaY/2;return g>2e3&&(g=2e3),g<100?100:g})},f=()=>{const n=_(i,a)-1;S(n)},q=()=>{const n=_(i,a)+1;S(n)},S=n=>{var l=n;l>=i.length&&(l=i.length-1),t.current.currentTime=i[l<0?0:l]||0},F=()=>{const n=_(i,a);n>0&&a==i[n-1]||(i.splice(n,0,a),d([...i]))},O=()=>{const n=i.findIndex(l=>l==a);n!=-1&&(i.splice(n,1),d([...i]))};return e.jsxs(h,{sx:{width:"100%"},children:[e.jsx(v,{sx:{width:"100%",overflow:"hidden",px:2},onWheel:m,children:e.jsxs(v,{sx:{width:`${u}%`,height:50,position:"relative",display:"flex",alignItems:"end"},children:[i.map((n,l)=>e.jsx(pe,{offset:n/r*100,time:n,selected:a==n,onClick:()=>o&&o(n)},l)),e.jsx(ee,{noLabels:!0,audio:t,onCurrentTimeChange:n=>s(n&&parseFloat(n.toFixed(1)))})]})}),e.jsx(De,{audio:t,onAdd:F,onRemove:O,onBackward:f,onForward:q})]})},_=(r,t)=>{for(var s=0;s<r.length;++s)if(t<r[s])return s;return r.length},qe=()=>{const r=te("track_root"),t=c.useRef(new Audio),[s,a]=c.useState(null),[o,i]=c.useState(null),[d,u]=c.useState([]),{setInfo:x}=re();c.useEffect(()=>{Be(r.data,a,u)},[r.data]),c.useEffect(()=>(t.current&&r&&(t.current.src=`${se}api/tracks/${r.data.id}/stream`),()=>{t.current&&(t.current.src="")}),[t.current,r]);const m=f=>{t.current.currentTime=f};return s===null?e.jsx(ae,{}):s===""?e.jsx(h,{sx:{width:"100%",height:"85%",alignItems:"center"},spacing:2,children:e.jsx(xe,{onAdded:f=>a(f)})}):e.jsxs(v,{sx:{width:"100%",height:"90%",display:"flex",flexDirection:"column",p:1},children:[e.jsx(ne,{flex:1,seekTime:m,current:o,stamps:d,lyrics:s}),e.jsx(P,{sx:{mb:1}}),e.jsxs(h,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(b,{children:oe(o)}),e.jsx(A,{variant:"contained",onClick:()=>Te(r.data,s,d,x),children:"Save"})]}),e.jsx(P,{sx:{my:1}}),e.jsx(ze,{stamps:d,setStamps:u,audio:t,setCurrentTime:m,currentTime:o,onCurrentTimeChange:i,max:t==null?void 0:t.current.duration})]})},Be=async(r,t,s)=>{try{const o=await(await M(`api/lyrics/tracks/${r.id}`)).json();t(o.data.lyrics);const i=o.data.timestamps.split(",");return s(o.data.timestamps.length==0?[]:i)}catch{t(""),s([])}},Te=async(r,t="",s=[],a)=>{var o={lyrics:t};s&&s.length>0&&(o.timestamps=s.join(",")),(await M(`api/lyrics/tracks/${r.id}`,"POST",o)).ok&&a("Lyrics had been updated successfully")};export{qe as default};
